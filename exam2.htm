<!DOCTYPE html>
<html lang="zh-TW">
<head>
 <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»è…¦å³æ¸¬å³è©•ç³»çµ±</title>
<script>
window.onload = function() {
  let A2 = localStorage.getItem("GM");
  console.log("GM =", A2);  // åœ¨é–‹ç™¼è€…å·¥å…·ä¸­æŸ¥çœ‹å€¼
  //alert("GM å€¼ç‚ºï¼š" + A2);  // é¡¯ç¤ºç›®å‰çš„å€¼


if (!A2 || A2 == 'null' || A2.trim().length === 0) {      
       //window.location.href = "exam1.htm";
      } else {
        document.getElementById('gm').value = A2;
      }
    };

</script>

<style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 0px; }
        .cen {  text-align: center; /* è®“ .cen è£¡é¢çš„æ–‡å­—ã€åœ–ç‰‡ç­‰è¡Œå…§å…§å®¹æ°´å¹³ç½®ä¸­ */}
        /* é¡Œè™ŸæŒ‰éˆ•æ¨£å¼ */
        #question-nav { margin-bottom: 25px; display: flex; flex-wrap: wrap; gap: 8px; }
        .nav-button {
            padding: 0px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            min-width: 30px;
            text-align: center;
            font-weight: bold;
            transition: background-color 0.2s, color 0.2s, border-width 0.1s;
        }
        /* æŒ‰é’®åˆå§‹çŠ¶æ€ï¼šæ·ºè—è‰² (æœªä½œç­”) */
        .nav-button.unanswered {
            background-color: #a0c4ff;
            color: #1a1a1a;
        }
        /* æŒ‰é’®ä½œç­”å¾Œç‹€æ…‹ï¼šç™½è‰² (å·²ä½œç­”) */
        .nav-button.answered {
            background-color: #ffffff;
            color: #000000;
            border-color: #007bff;
        }
        /* ç•¶å‰é¡Œç›®é«˜äº®é¡¯ç¤º */
        .nav-button.current-q {
            border-width: 3px;
            border-color: #ff5722;
        }

      .question-card { text-align: left;font-size:20px;border: 1px solid #ddd; padding: 5px; border-radius: 8px; min-height: 120px; }
      .option-label {font-size:25px;display: block; margin: 10px 0; cursor: pointer; padding: 5px; border-radius: 3px; }
      .option-label:hover { background-color: #f0f0f0; }
      button#show-submit-btn {  font-size:20px;padding: 10px 20px; cursor: pointer; margin-top: 30px; display: none; }

        #user-info, #result { margin-top: 10px; padding: 15px; border: 2px dashed #007bff; border-radius: 5px; }

.button-container {
    /* è®“å®¹å™¨å…§çš„è¡Œå…§å…ƒç´ ï¼ˆåŒ…æ‹¬æŒ‰éˆ•ï¼‰æ°´å¹³ç½®ä¸­ */
    text-align: center; 
}

#show-submit-btn {
    /* è¨­å®šæ·±ç´…è‰²èƒŒæ™¯ */
    background-color: darkred; 
    /* è¨­å®šæ–‡å­—é¡è‰²ç‚ºç™½è‰²ï¼Œå¢åŠ å¯è®€æ€§ */
    color: white;             
    /* ç§»é™¤é‚Šæ¡†ï¼Œè®“æ¨£å¼æ›´ä¹¾æ·¨ */
    border: none;             
    /* å¢åŠ å…§é‚Šè·ï¼Œè®“æŒ‰éˆ•çœ‹èµ·ä¾†å¤§ä¸€é» */
    padding: 10px 20px;       
    /* å¢åŠ åœ“è§’ï¼Œè®“æŒ‰éˆ•æ›´ç¾è§€ */
    border-radius: 5px;       
    /* è®“æ»‘é¼ ç§»éå»æ™‚æœ‰æç¤ºæ•ˆæœ */
    cursor: pointer;          
}

    </style>
</head>
<body>
 <div class="cen">
    <h1>é›»è…¦å³æ¸¬å³è©•ç³»çµ±</h1><span style="display: none;" id="question-count">10</span>
    
    <div id="question-nav">
        éš¨æ©Ÿé¸é¡Œè£½ä½œä¸­â€¦
    </div>

    <div id="quiz-container">
        <p>æ­£åœ¨åŠ è¼‰é¡Œç›®ï¼Œè«‹ç¨å€™...</p>
    </div>
<div class="progress-container" id="wa" style="display: block;">
  <div class="progress-bar-scanner"></div>
</div>

<div class="button-container">
    <button id="show-submit-btn" onclick="showSubmitForm()">å®Œæˆä½œç­”ï¼Œæäº¤æˆç¸¾</button>
</div>


    <div id="user-info" style="display: none;"> 
        <h2>ä½œç­”å®Œç•¢</h2>
        <input style="display: none;" type="email" id="email" required  style="width: 250px;" readonly>
        <br>
        <button style="font-size:20px;" id="submit-quiz-btn" onclick="submitQuiz()">æŸ¥çœ‹æˆç¸¾</button>
    </div>

    <div id="result" style="display: none;">
    </div>

</div>

    <script>
 let A2 = localStorage.getItem("GM");
document.getElementById('email').value = A2;
const NUM_QUESTIONS = 20; 

        // *** è«‹å°‡æ‚¨çš„ Apps Script Web App URL è²¼åˆ°é€™è£¡ ***
        const GS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzr3GI3uu-SGRRdsu_u8b8eCHn-qpZnVic6BSCitUqZK6U6OyhLkz5-W9iKgl37-PE/exec'; 
        

        document.getElementById('question-count').textContent = NUM_QUESTIONS;
        let questionsData = []; 
        let userAnswers = {};   
        let currentQuestionIndex = 0; 

        /**
         * 1. ç²å–è€ƒé¡Œ - æœ€çµ‚ç‰ˆæœ¬ï¼šä½¿ç”¨ FormData
         */
        async function fetchQuestions() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = 'è€ƒé¡Œè£½ä½œä¸­ï¼Œè«‹ç¨ç­‰â€¦â€¦';

            const formData = new FormData(); // ğŸŒŸ é—œéµï¼šä½¿ç”¨ FormData
            formData.append('numQuestions', NUM_QUESTIONS); 

            try {
                const response = await fetch(GS_WEB_APP_URL + '?action=getQuestions', {
                    method: 'POST',
                    body: formData // ç™¼é€ FormData
                });

                const result = await response.json();

                if (result.success) {
                    questionsData = result.data;
                    initializeQuiz();
                } else {
                    container.innerHTML = `<p style="color: red;">åŠ è¼‰é¡Œç›®å¤±æ•—: ${result.error}</p>`;
                }
            } catch (error) {
                container.innerHTML = `<p style="color: red;">ç¶²çµ¡è«‹æ±‚éŒ¯èª¤: ${error.message}</p>`;
            }
        }

        /**
         * 2. åˆå§‹åŒ–æ¸¬é©—ç•Œé¢ (ç”Ÿæˆé¡Œè™ŸæŒ‰éˆ•å’Œé¡¯ç¤ºç¬¬ä¸€é¡Œ)
         */
        function initializeQuiz() {
	document.getElementById("wa").style.display = "none";
            const navContainer = document.getElementById('question-nav');
            navContainer.innerHTML = '';
            
            for (let i = 0; i < NUM_QUESTIONS; i++) {
                userAnswers['q' + i] = null; 

                const button = document.createElement('div');
                button.textContent = i + 1;
                button.className = 'nav-button unanswered';
                button.id = `nav-btn-${i}`;
                button.onclick = () => showQuestion(i);
                navContainer.appendChild(button);
            }

            // é¡¯ç¤ºç¬¬ä¸€é¡Œ
            showQuestion(0);
            document.getElementById('show-submit-btn').style.display = 'block';
        }

        /**
         * 3. é¡¯ç¤ºæŒ‡å®šç´¢å¼•çš„é¡Œç›®
         */
        function showQuestion(index) {
            if (index < 0 || index >= NUM_QUESTIONS) return;
            currentQuestionIndex = index;
            const q = questionsData[index];
            const container = document.getElementById('quiz-container');

            // æ¸²æŸ“å–®é¡Œå¡ç‰‡
            container.innerHTML = `
                <div class="question-card">
                    <h3>${index + 1}. ${q.item}</h3>
                    <div id="options-for-q${index}">
                        ${q.options.map((opt, optIndex) => `
                            <label class="option-label">
                                <input type="radio" 
                                       name="q${index}" 
                                       value="${opt.key}" 
                                       data-is-correct="${opt.isCorrect}" 
                                       onchange="recordAnswer(${index}, '${opt.key}')"
                                       ${userAnswers['q' + index] === opt.key ? 'checked' : ''}>
                                ${opt.text}
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // æ›´æ–°å°èˆªæŒ‰éˆ•çš„é«˜äº®ç‹€æ…‹
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('current-q'));
            document.getElementById(`nav-btn-${index}`).classList.add('current-q');
        }

        /**
         * 4. è¨˜éŒ„ä½œç­”ä¸¦æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼Œè‡ªå‹•è·³ä¸‹ä¸€é¡Œ
         */
        function recordAnswer(index, selectedKey) {
            userAnswers['q' + index] = selectedKey;
            
            const btn = document.getElementById(`nav-btn-${index}`);
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            btn.classList.remove('unanswered');
            btn.classList.add('answered');
            
            // æ›´æ–°æŒ‰éˆ•æ–‡æœ¬
            btn.textContent = `${index + 1}. ${selectedKey}`; 

            // è‡ªå‹•è·³ä¸‹ä¸€é¡Œ
            if (index < NUM_QUESTIONS - 1) {
                setTimeout(() => showQuestion(index + 1), 100); 
            }
        }

        /**
         * 5. é¡¯ç¤ºä½¿ç”¨è€…æäº¤è¡¨å–®
         */
        function showSubmitForm() {
            document.getElementById('quiz-container').style.display = 'none';
            document.getElementById('show-submit-btn').style.display = 'none';
            document.getElementById('question-nav').style.display = 'none';
            document.getElementById('user-info').style.display = 'block';
        }

        /**
         * 6. æäº¤æˆç¸¾ - æœ€çµ‚ç‰ˆæœ¬ï¼šä½¿ç”¨ FormData
         */
        async function submitQuiz() {
            const email = document.getElementById('email').value.trim();
            if (!email) {
                alert('è«‹å¡«å¯«æ‚¨çš„ Gmail éƒµç®±ï¼');
                return;
            }

            // --- è¨ˆç®—æˆç¸¾ ---
            let totalCorrect = 0;
            questionsData.forEach((q, index) => {
                const selectedKey = userAnswers['q' + index];
                const correctOption = q.options.find(opt => opt.isCorrect);

                if (selectedKey && correctOption && selectedKey === correctOption.key) {
                    totalCorrect++;
                }
            });
            const score = Math.round((totalCorrect / NUM_QUESTIONS) * 100);

            // --- æº–å‚™ UI ---
            document.getElementById('submit-quiz-btn').disabled = true;
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
	wa.style.display = 'block';
            resultDiv.innerHTML = '<p>æ­£åœ¨æäº¤æˆç¸¾...</p>';

            // ğŸŒŸ é—œéµï¼šä½¿ç”¨ FormData æ§‹é€ ä¿¡ç®±å’Œæˆç¸¾æ•¸æ“š
            const formData = new FormData();
            formData.append('email', email); // éµå 'email'
            formData.append('score', score); // éµå 'score'

            // å„²å­˜æˆç¸¾åˆ° Google Sheets
            try {
                const response = await fetch(GS_WEB_APP_URL + '?action=saveScore', {
                    method: 'POST',
                    body: formData // ç™¼é€ FormData å°è±¡
                });

                const saveResult = await response.json();

                // --- é¡¯ç¤ºçµæœ ---
                if (saveResult.success) {
	wa.style.display = 'none';
                    resultDiv.innerHTML = `
                        <h2>æ¸¬é©—çµæœ</h2>
                        <p>ä¿¡ç®±: **${email}**</p>
                        <p>ç­”å°é¡Œæ•¸: **${totalCorrect}** / ${NUM_QUESTIONS}</p>
                        <p>æ‚¨çš„å¾—åˆ†: **${score}** åˆ†</p>
                        <p style="color: green;">âœ… æˆç¸¾æˆåŠŸé€å‡º</p>
                    `;
                } else {
                    resultDiv.innerHTML = `<p style="color: red;">âŒ æˆç¸¾è¨˜éŒ„å¤±æ•—: ${saveResult.error}</p>`;
                }
                document.getElementById('user-info').style.display = 'none';
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">ç¶²çµ¡è«‹æ±‚éŒ¯èª¤ï¼Œæˆç¸¾æœªè¨˜éŒ„: ${error.message}</p>`;
                document.getElementById('submit-quiz-btn').disabled = false;
            }
        }

        document.addEventListener('DOMContentLoaded', fetchQuestions);
    </script>

<style>
/* 1. å¤–å±¤å®¹å™¨ - é€²åº¦æ¢çš„ã€Œè»Œé“ã€ (ä¸è®Š) */
.progress-container {
  width: 100%;
  max-width: 600px;
  height: 25px;
  background-color: #e0e0e0;
  border-radius: 12px;
  overflow: hidden;
  margin: 20px auto;
  position: relative;
}

/* 2. é€²åº¦æ¢æœ¬èº« (åº•è‰²) (ä¸è®Š) */
.progress-bar-scanner {
  width: 100%;
  height: 100%;
  background-color: #4CAF50; /* æ•´å€‹æ¢å­çš„ç¶ è‰²èƒŒæ™¯ */
  position: relative;
}

/* 3. é»ƒè‰²å…‰é» (ä½¿ç”¨ ::after å½å…ƒç´ ) */
.progress-bar-scanner::after {
  content: "";
  display: block;
  
  /* åˆå§‹å¤§å° */
  width: 5px; /* å…‰é»çš„åˆå§‹å¯¬åº¦ï¼Œæ¯”ä¹‹å‰å° */
  height: 100%; /* å’Œé€²åº¦æ¢ä¸€æ¨£é«˜ */
  
  background-color: #FFD700; /* **é»ƒè‰²** */
  box-shadow: 0 0 10px 5px #FFD700; /* é»ƒè‰²ç™¼å…‰æ•ˆæœ */
  
  position: absolute;
  top: 0;
  
  /* å•Ÿç”¨å‹•ç•« */
  animation: scan-grow-light 2.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; /* èª¿æ•´å‹•ç•«åç¨±å’Œæ™‚é–“ */
}

/* 4. å®šç¾© Keyframes å‹•ç•« - åŒ…å«å¤§å°è®ŠåŒ– */
@keyframes scan-grow-light {
  0% {
    left: -5px; /* å¾è»Œé“å·¦å´å¤–é¢é–‹å§‹ï¼Œèˆ‡åˆå§‹å¯¬åº¦åŒ¹é… */
    transform: scaleX(1); /* åˆå§‹å¤§å° */
    opacity: 0.8; /* åˆå§‹é€æ˜åº¦ */
  }
  
  30% { /* é–‹å§‹è®Šå¤§ */
    transform: scaleX(2); /* è®Šç‚ºå…©å€å¯¬ */
    opacity: 1; /* å®Œå…¨ä¸é€æ˜ */
  }
  
  70% { /* é”åˆ°æœ€å¤§å¾Œé–‹å§‹ç¸®å° */
    transform: scaleX(2); /* ç¶­æŒæœ€å¤§å¯¬åº¦ */
    opacity: 1;
  }

  100% {
    left: calc(100% + 5px); /* ç§»å‹•åˆ°æœ€å³å´å¤–é¢ */
    transform: scaleX(1); /* ç¸®å›åˆå§‹å¤§å° */
    opacity: 0.8; /* çµæŸæ™‚é€æ˜åº¦ç¨é™ */
  }
}
</style>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
</body>
</html>