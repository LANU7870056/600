<meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
 body {
            background: linear-gradient(135deg, #4285f4 0%, #ea4335 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2px;
        }
   .container {
            background-color: #0088FF;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
            padding: 4px 3px;
	    align-items: center;
            text-align: center;
            animation: fadeIn 0.5s ease-in;
        }
</style>

<div class="container">

<div style="background-color:#0088FF; border-radius: 15px; padding: 0px; border: 1px solid #0088FF; ">

<h1 style="width:100%;color: yellow; text-align: center; margin: 0 auto;">線上點名單</h1>


<form id="submission-form"> 

<table style="width:95%;border-style: solid; display: block; margin: 0 auto;" border="0">

    <tr>
      <td  style="font-size: 2em;color: white;" height="61"  ><b>班級：</b></td>
      <td height="61">
        <select name="T1"  style="font-size: 2em;">
          <option value="0">請選擇</option>
          <option value="101">101</option>
          <option value="102">102</option>
          <option value="103">103</option>
          <option value="104">104</option>
          <option value="105">105</option>
          <option value="108">108</option>
          <option value="109">109</option>
          <option value="110">110</option>
          <option value="111">111</option>
          <option value="113">113</option>
          <option value="114">114</option>
        </select>
      </td>
    </tr>
    <tr>
      <td  style="font-size: 2em;color: white;" height="65"><b>座號：</b></td>
      <td height="65">


        <input name="T2" size="4" style="font-size: 2em;"  inputmode="numeric" 
onmouseover="this.oninput=function(){
  this.value = this.value.replace(/[^0-9]/g,'');
  if (this.value !== '' && (parseInt(this.value) < 1 || parseInt(this.value) > 50)) {
    this.value = '';
  }
}">


      </td>
    </tr>
    <tr>


      <td colspan="2">

<input id="gm" name="gm" size="18" style="font-size: 1.5em; font-weight: 700; background-color: #d3d3d3; color: #f0f0f0;" readonly>
<input id="dn" name="dn" size="18" style="font-size: 1.5em; font-weight: 700; background-color: #d3d3d3; color: #f0f0f0;" readonly>




      </td>
    </tr>
  </table>
  <p style="text-align: center;">
    <input style="font-size: 2em;" type="submit" value="傳送" name="B1">

  </p>
</form>    


<div class="progress-container" id="wa" style="display: none;">
        <div class="progress-bar"></div>
        <div class="percentage-text" id="percentage-display">0%</div>
</div>

    <div id="response-message" style="margin-top: 15px; font-weight: bold;"></div>


<script>
window.onload = function() {
  let A2 = localStorage.getItem("GM");
  let ip = localStorage.getItem("ip");
  let dn = localStorage.getItem("dn");
  console.log("GM =", A2);  // 在開發者工具中查看值
  //alert("GM 值為：" + A2);  // 顯示目前的值


if (!A2 || A2 == 'null' || A2.trim().length === 0) {      
       window.location.href = "gooin02.htm";
      } else {
        document.getElementById('gm').value = A2;
        document.getElementById('dn').value = dn;
        document.getElementById('ip').value = ip;
      }
    };

</script>






<script>


//儲存至DB 工作表1


    // 請將這裡的 URL 替換為您最新的 Apps Script Web App URL
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwZj3EIWy_BbvSZgUEFNSjnAIDMwq3YRcMJ6Th6HqBZ2DIZeyBFZZCCxTdTZmnUYkUJWw/exec';
    
    // 透過 ID 抓取表單（確保表單標籤有 id="submission-form"）
    const form = document.getElementById('submission-form');
    const responseMessage = document.getElementById('response-message');

    form.addEventListener('submit', e => {

 var t1 = document.getElementsByName("T1")[0].value;
  var t2 = document.getElementsByName("T2")[0].value.trim();
if (t1 === "0" ) {
    alert("請選擇「班級」 ");
    return false; // 阻止表單送出或後續動作
  }

if (t2 === "") {
    alert("請輸入「座號」");
    return false; // 阻止表單送出或後續動作
  }

        e.preventDefault(); // ⬅️ 關鍵：阻止瀏覽器進行傳統頁面跳轉
	document.getElementById("wa").style.display = "block";
	responseMessage.style.color = 'yellow';
        responseMessage.textContent = '資料傳送中，請稍等……'; // 顯示提交狀態
       
        responseMessage.style.fontSize = '1.5em';
        const formData = new FormData(form);

        fetch(scriptURL, { 
            method: 'POST', 
            body: formData,
        })
        .then(response => {
            // 檢查 HTTP 狀態碼
            if (!response.ok) {
                throw new Error(`HTTP Error! Status: ${response.status}`);
            }
            return response.json(); // 解析 Apps Script 回傳的 JSON 格式
        })
        .then(data => {
            // 根據 Apps Script 回傳的 JSON 內容判斷
            if (data.result === 'success') {
                responseMessage.style.color = 'yellow';
                responseMessage.textContent = '點名資料傳送成功！可關閉視窗'; // ⬅️ 在本頁面顯示成功訊息
	 	document.getElementById("wa").style.display = "none";


                form.reset(); // 清除表單內容
            } else {
                // Apps Script 回傳了 JSON 但結果為 error
                responseMessage.style.color = 'red';
                responseMessage.textContent = '提交失敗: ' + (data.error || '未知錯誤');
            }
        })
        .catch(error => {
            // 處理網路錯誤或 JSON 解析錯誤
            responseMessage.style.color = 'red';
            // 這裡顯示更精確的錯誤訊息，例如如果您還是在本地運行（CORS 錯誤）
            responseMessage.textContent = '連線或處理失敗，請檢查網頁是否從伺服器載入。'; 
            console.error('Fetch Error:', error);
        });
    });
</script>




  <style>
        /* 1. 設定整體頁面樣式 (與前一個版本相同) */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f4f9;
            font-family: Arial, sans-serif;
            flex-direction: column;
        }

        /* 2. 外層容器：進度條的邊框和背景 (與前一個版本相同) */
        .progress-container {
            width: 95%;
            max-width: 500px;
            height: 30px;
            background-color: #ddd;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            position: relative;
        }

        /* 3. 進度條本身：關鍵變動在這裡！ */
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 15px;
            /* **【變動一：移除 forwards】** */
            /* 讓動畫跑完後不會停在 100%，而是可以重置 */
            animation: progress-fill 5s linear; 
            box-sizing: border-box;
        }
        
        /* 4. 顯示文字和百分比的容器 (與前一個版本相同) */
        .status-text {
            color: #333;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        /* 5. 顯示百分比的容器 (與前一個版本相同) */
        .percentage-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-weight: bold;
            font-size: 1.2em;
            z-index: 2; 
        }

        /* ================================== */
        /* 6. @KEYFRAMES: 定義動畫步驟 (與前一個版本相同) */
        /* ================================== */
        
        /* 進度條寬度動畫：從 0% 到 100% */
        @keyframes progress-fill {
            from {
                width: 0%;
            }
            to {
                width: 100%;
            }
        }
    </style>