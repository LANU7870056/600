<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  
<meta charset="UTF-8">
<title>è³‡æ–™è¼¸å…¥è¡¨å–®</title>
<style>
    /* å¯é¸ï¼šè®“è¡¨å–®æ›´å¥½çœ‹ä¸€é» */
    body { font-family: Arial, sans-serif; margin: 0px; }
    form { width: 70%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
    label, input, select, button { display: block; margin-bottom: 10px; }
    input[type="text"], input[type="number"], select { width: 70%; padding: 8px; box-sizing: border-box; }
    button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }

.centered-box {
    display: flex;
    justify-content: center; /* æ°´å¹³ç½®ä¸­ */
    align-items: center;     /* å‚ç›´ç½®ä¸­ */
    width: 70%;
    margin: 0px auto; /* ç½®ä¸­ */
    background-color: #e0f0ff; /* æ·ºè—åº•è‰² */
    border-top-left-radius: 15px;
    border-top-right-radius: 15px; /* ä¸Šæ–¹åœ“è§’ */
    padding: 0px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* å¯é¸ï¼šåŠ é»é™°å½± */
    text-align: center; /* å…§å®¹ç½®ä¸­ */
  }


.centered-box {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  min-height: 100vh;
}

form#myForm {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.la {
  margin: 10px 0;
font-size:1.5em;
  text-align: center;
  width: 250px;
}

button.la {
  width: 150px;
}




</style>

<div class="centered-box">

<form id="myForm"> 
<h1>é›»å­é»å</h1>
    <input type="hidden" id="backurl" value="https://lanu7870056.github.io/600/order01.htm" name="backurl">
   
    <input class="la" type="text" id="gmail"  name="GMAIL" style="background-color: #d3d3d3;" readonly >

    <label class="la" for="classId">ç­ç´š:</label>
    <select class="la" id="classId" name="ç­ç´š" required>
        <option value="">-- è«‹é¸æ“‡ç­ç´š --</option>
        <option value="101">101</option>
        <option value="102">102</option>
        <option value="103">103</option>
    </select>

    <label class="la" for="seatNum">åº§è™Ÿ (1~50):</label>
    <input class="la" type="number" id="seatNum" name="åº§è™Ÿ" min="1" max="50" value="20" required>

    <button class="la" type="submit">é€å‡ºè³‡æ–™</button>
</form>
</div>
<p id="responseMessage" style="margin-top: 20px; font-weight: bold;"></p>

<script>
let A = localStorage.getItem("GM");  //å–å‡º
gmail.value=A;


    // âš ï¸ é€™æ˜¯æ‚¨ Apps Script çš„ Web App URLï¼Œè«‹ç¢ºèªå®ƒæ˜¯å¦æ­£ç¢º
    const APP_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbysGyVzYeLYlX_hxlff_KoCgXZma1ayMujEl8D4bq0jsPOmM8Gd6p9sofIdzt2my325/exec"; 
    
    document.getElementById('myForm').addEventListener('submit', async function(event) {
        // â­ï¸ é˜»æ­¢ç€è¦½å™¨åŸ·è¡Œå‚³çµ±æäº¤ (é—œéµæ­¥é©Ÿï¼Œè®“ç¶²å€æ¬„ä¸è®Š)
        event.preventDefault(); 

        const form = event.target;
        const formData = new FormData(form);
        const data = {};
        formData.forEach((value, key) => { data[key] = value; });

        const responseMessage = document.getElementById('responseMessage');
        responseMessage.textContent = 'è³‡æ–™è™•ç†ä¸­...';
        responseMessage.style.color = 'blue';

        try {
            const response = await fetch(APP_SCRIPT_URL, {
                method: 'POST',
                // å°‡æ•¸æ“šè½‰æ›ç‚º Apps Script æœŸæœ›çš„æ ¼å¼
                body: new URLSearchParams(data) 
            });

            if (!response.ok) {
                throw new Error(`ä¼ºæœå™¨ HTTP éŒ¯èª¤: ${response.status}`);
            }

            // â­ï¸ è§£æ Apps Script å›å‚³çš„ JSON ç‹€æ…‹
            const result = await response.json(); 

            if (result.status === 'duplicate') {
                // ğŸš¨ è³‡æ–™é‡è¤‡ï¼šåœ¨ç•¶å‰é é¢å½ˆçª—ä¸¦æ›´æ–°è¨Šæ¯
                alert("è³‡æ–™é‡è¦†"); 
                responseMessage.textContent = 'âŒ ' + result.message;
                responseMessage.style.color = 'red';
            } else if (result.status === 'success') {
                // âœ… è³‡æ–™æ–°å¢æˆåŠŸ
                alert("è³‡æ–™é€å‡ºæˆåŠŸï¼");
                responseMessage.textContent = 'âœ… ' + result.message;
                responseMessage.style.color = 'green';
                form.reset(); // æ¸…ç©ºè¡¨å–®æ¬„ä½
            } else {
                // è™•ç† Apps Script å›å‚³çš„å…¶å®ƒéŒ¯èª¤ (å¦‚åº§è™Ÿç¯„åœéŒ¯èª¤)
                alert("è³‡æ–™è™•ç†éŒ¯èª¤ï¼š" + result.message);
                responseMessage.textContent = 'âš ï¸ ' + result.message;
                responseMessage.style.color = 'orange';
            }

        } catch (error) {
            alert("ç¶²è·¯é€£ç·šæˆ– Apps Script éŒ¯èª¤ï¼");
            responseMessage.textContent = 'âŒ é€£ç·šå¤±æ•—: ' + error.message;
            responseMessage.style.color = 'red';
        }
    });
</script>

</body>
</html>